<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>RÃ©fÃ©rentiel DD&RS â€“ Arbre Radial ColorÃ©</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; overflow: auto;
      font-family: sans-serif;
    }
    h1 {
      margin: 1em 0 0.5em;
      text-align: center;
    }
    #chart {
      width: 100vw;
      height: calc(100vh - 3.5em);
      overflow: auto;
    }
    svg {
      display: block;
      width: 100%;
      height: 100%;
    }
    .node:hover circle {
      stroke: orange;
      stroke-width: 2px;
    }
  </style>
</head>
<body>
  <h1>ðŸŒ³ RÃ©fÃ©rentiel DD&RS ðŸŒ³</h1>
  <div id="chart"></div>

  <script>
  (function() {
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // 1) DÃ©finis ici tes couleurs manuellement
    const rootColor    = "#2c3e50";                   // couleur du nÅ“ud central
    const axisColors   = [                           // couleurs des 5 axes
      "#1f77b4", // 1. StratÃ©gie
      "#ff7f0e", // 2. Enseignement
      "#2ca02c", // 3. Recherche
      "#d62728", // 4. Environnement
      "#9467bd"  // 5. Sociale
    ];
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

    const data = {
      name: "LE REFERENTIEL DD&RS",
      children: [
        {
          name: "1. StratÃ©gie & Gouvernance",
          children: [
            { name: "1.1 Formaliser sa politique DD&RS" },
            { name: "1.2 DÃ©ployer des ressources" },
            { name: "1.3 SociÃ©tÃ© responsable" }
          ]
        },
        {
          name: "2. Enseignement & Formation",
          children: [
            { name: "2.1 IntÃ©grer le DD&RS" },
            { name: "2.2 DÃ©velopper les compÃ©tences" },
            { name: "2.3 Soutenir les enseignant.es" },
            { name: "2.4 SociÃ©tÃ© de la connaissance" }
          ]
        },
        {
          name: "3. Recherche & Innovation",
          children: [
            { name: "3.1 StratÃ©gie R&I" },
            { name: "3.2 Science/sociÃ©tÃ©" },
            { name: "3.3 RÃ©flexion Ã©thique" }
          ]
        },
        {
          name: "4. Gestion environnementale",
          children: [
            { name: "4.1 Ã‰missions & ressources" },
            { name: "4.2 Pollution" },
            { name: "4.3 BiodiversitÃ©" },
            { name: "4.4 Alimentation responsable" }
          ]
        },
        {
          name: "5. Politique sociale",
          children: [
            { name: "5.1 Ã‰galitÃ© & diversitÃ©" },
            { name: "5.2 CompÃ©tences DD&RS" },
            { name: "5.3 QualitÃ© de vie" },
            { name: "5.4 Ã‰galitÃ© des chances" }
          ]
        }
      ]
    };

    function chart() {
      const W      = window.innerWidth;
      const H      = window.innerHeight;
      const radius = Math.min(W, H) / 2 - 80;
      const tree   = d3.tree().size([2 * Math.PI, radius]);
      const root   = d3.hierarchy(data);

      // â€“ assignation ID + stockage children
      let idx = 0;
      root.each(d => {
        d.id         = idx++;
        d._children  = d.children || null;
      });

      // â€“ couleur racine
      root.color = rootColor;

      // â€“ couleur de chaque grand axe (depth=1)
      root.children.forEach((axis, i) => {
        axis.color = axisColors[i % axisColors.length];
      });

      // â€“ propagation aux sous-axes (depthâ‰¥2)
      root.each(d => {
        if (d.depth >= 2) {
          // on trouve l'ancÃªtre depth=1
          let anc = d;
          while (anc.depth > 1) anc = anc.parent;
          // plus on est profond, plus on Ã©claircit
          const factor = 1 + 0.3 * (d.depth - 1);
          d.color = d3.color(anc.color).brighter(factor).formatHex();
        }
      });

      tree(root);

      // â€“ SVG centrÃ© avec viewBox
      const svg = d3.create("svg")
        .attr("viewBox", [-W/2, -H/2, W, H])
        .style("font", "12px sans-serif")
        .style("user-select", "none");

      const g     = svg.append("g");
      const linkG = g.append("g").attr("class", "links");
      const nodeG = g.append("g").attr("class", "nodes");

      const diagonal = d3.linkRadial()
        .angle(d => d.x)
        .radius(d => d.y);

      // â€”â€”â€” update() â€”â€”â€”
      function update() {
        tree(root);

        const links = root.links();
        const nodes = root.descendants();

        // Liens
        linkG.selectAll("path.link")
          .data(links, d => d.target.id)
          .join(
            enter => enter.append("path")
              .attr("class", "link")
              .attr("d", diagonal)
              .attr("fill", "none")
              .attr("stroke", "#999")
              .attr("stroke-width", 1.5),
            upd => upd.transition().duration(300).attr("d", diagonal),
            exit => exit.remove()
          );

        // NÅ“uds
        nodeG.selectAll("g.node")
          .data(nodes, d => d.id)
          .join(
            enter => {
              const ng = enter.append("g")
                .attr("class", "node")
                .attr("transform", d => {
                  const ang = d.x - Math.PI/2;
                  return `translate(${
                    d.y * Math.cos(ang)
                  },${
                    d.y * Math.sin(ang)
                  })`;
                })
                .style("cursor", d => d._children ? "pointer" : "default")
                .on("click", (e, d) => {
                  if (!d._children) return;
                  if (d.children) {
                    d._children = d.children;
                    d.children  = null;
                  } else {
                    d.children = d._children;
                  }
                  update();
                });

              // Cercle
              ng.append("circle")
                .attr("r", d => d.depth === 0 ? 14 : d.depth === 1 ? 10 : 6)
                .attr("fill", d => d.color)
                .attr("stroke", "#333");

              // Texte
              const text = ng.append("text")
                .text(d => d.data.name)
                .style("font-weight", d => d.depth <= 1 ? "bold" : "normal")
                .style("font-size", d => d.depth === 0 ? "18px" : "12px")
                .style("fill", d => d.color);

              if (d.depth === 0) {
                // titre racine au-dessus, centrÃ©
                text
                  .attr("dy", "-1.6em")
                  .attr("text-anchor", "middle");
              } else {
                // sous-axes et axes orientÃ©s horizontalement
                text
                  .attr("dy", "0.31em")
                  .attr("x", d => d.x < Math.PI ? 12 : -12)
                  .attr("text-anchor", d => d.x < Math.PI ? "start" : "end");
              }

              return ng;
            },
            upd => upd.transition().duration(300)
              .attr("transform", d => {
                const ang = d.x - Math.PI/2;
                return `translate(${
                  d.y * Math.cos(ang)
                },${
                  d.y * Math.sin(ang)
                })`;
              }),
            exit => exit.remove()
          );
      }

      update();
      return svg.node();
    }

    // Rendu initial + resize
    function render() {
      const c = document.getElementById("chart");
      c.innerHTML = "";
      c.appendChild(chart());
    }
    window.addEventListener("resize", render);
    document.addEventListener("DOMContentLoaded", render);

  })();
  </script>
</body>
</html>
